# GitHub Actions å·¥ä½œæµé…ç½®æ€»ç»“

## ğŸ“‹ å·²åˆ›å»ºæ–‡ä»¶æ¸…å•

### å·¥ä½œæµæ–‡ä»¶ (.github/workflows/)

1. **build.yml** (Release ç‰ˆæœ¬æ„å»º)
   - è§¦å‘ï¼šæ¨é€ `v*` Tag
   - ç›®æ ‡å¹³å°ï¼šAndroid, iOS, Linux, Windows, Web
   - è¾“å‡ºï¼šGitHub Release è‡ªåŠ¨åˆ›å»º
   - æ—¶é—´ï¼š~30-45 åˆ†é’Ÿ

2. **ci.yml** (æŒç»­é›†æˆ)
   - è§¦å‘ï¼šPush åˆ° main/developï¼Œæˆ– PR
   - ä»»åŠ¡ï¼šä»£ç æ£€æŸ¥ã€æµ‹è¯•ã€Debug æ„å»º
   - è¾“å‡ºï¼šArtifactsï¼ˆä¿å­˜ 5 å¤©ï¼‰

3. **deploy-web.yml** (Web éƒ¨ç½²)
   - è§¦å‘ï¼šæ¨é€ Tag æˆ– main åˆ†æ”¯
   - åŠŸèƒ½ï¼šWeb åº”ç”¨è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages
   - è®¿é—®ï¼š`https://<username>.github.io/danbooru-viewer/`

### æ–‡æ¡£æ–‡ä»¶

1. **.github/WORKFLOWS.md** (å·¥ä½œæµå®Œæ•´æŒ‡å—)
   - è¯¦ç»†è¯´æ˜ä¸‰ä¸ªå·¥ä½œæµ
   - ä½¿ç”¨ç¤ºä¾‹å’Œé—®é¢˜è§£å†³
   - ä¼˜åŒ–å»ºè®®å’Œæœ€ä½³å®è·µ

2. **.github/VERSION_HISTORY.md** (ç‰ˆæœ¬å†å²å’Œé…ç½®è®°å½•)
   - å·¥ä½œæµç‰ˆæœ¬ç®¡ç†
   - æ€§èƒ½æŒ‡æ ‡
   - éƒ¨ç½²æ¸…å•
   - æœªæ¥æ”¹è¿›è®¡åˆ’

3. **CHANGELOG.md** (é¡¹ç›®å˜æ›´æ—¥å¿—)
   - ç‰ˆæœ¬å‘å¸ƒå†å²
   - å˜æ›´ç±»å‹åˆ†ç±»
   - å‘å¸ƒè®¡åˆ’

4. **RELEASE_GUIDE.md** (å¿«é€Ÿå‘å¸ƒæŒ‡å—)
   - 5 åˆ†é’Ÿå¿«é€Ÿå‘å¸ƒæ­¥éª¤
   - è¯¦ç»†å‘å¸ƒæµç¨‹
   - æ•…éšœæ’æŸ¥
   - å‘½ä»¤é€ŸæŸ¥è¡¨

5. **README.md** (å·²æ›´æ–°)
   - æ·»åŠ äº† CI/CD éƒ¨åˆ†
   - å¿«é€Ÿå‘å¸ƒè¯´æ˜
   - å·¥ä½œæµé“¾æ¥

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### é¦–æ¬¡è®¾ç½®ï¼ˆä¸€æ¬¡æ€§ï¼‰

1. **æ¨é€ä»£ç åˆ° GitHub**
   ```bash
   git push origin main
   ```

2. **å¯ç”¨ GitHub Pages**ï¼ˆç”¨äº Web éƒ¨ç½²ï¼‰
   - Settings â†’ Pages â†’ Source: Deploy from a branch
   - Branch: gh-pages

### å‘å¸ƒæ–°ç‰ˆæœ¬

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·å’Œ CHANGELOG
# ç¼–è¾‘ pubspec.yaml å’Œ CHANGELOG.md

# 2. æäº¤æ›´æ”¹
git add pubspec.yaml CHANGELOG.md
git commit -m "chore: release v1.0.0"
git push origin main

# 3. åˆ›å»º Tag å¹¶æ¨é€ï¼ˆè§¦å‘è‡ªåŠ¨æ„å»ºï¼‰
git tag v1.0.0
git push origin v1.0.0
```

---

## ğŸ“Š å·¥ä½œæµæ¦‚è§ˆ

```
Git Push
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             â”‚
â”‚ Tag: v*               Branch: main/develop
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GitHub Actions è§¦å‘         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [CI å·¥ä½œæµ]                 â”‚
â”‚ - ä»£ç æ ¼å¼æ£€æŸ¥              â”‚
â”‚ - é™æ€åˆ†æ                  â”‚
â”‚ - å•å…ƒæµ‹è¯•                  â”‚
â”‚ - Debug æ„å»º                â”‚
â”‚ â†’ Artifacts (ä¿ç•™ 5 å¤©)     â”‚
â”‚                             â”‚
â”‚ [Build Release å·¥ä½œæµ]      â”‚
â”‚ - å¹¶è¡Œæ„å»º 5 ä¸ªå¹³å°         â”‚
â”‚   - Android APK             â”‚
â”‚   - iOS IPA                 â”‚
â”‚   - Linux                   â”‚
â”‚   - Windows                 â”‚
â”‚   - Web                     â”‚
â”‚ â†’ GitHub Release            â”‚
â”‚                             â”‚
â”‚ [Deploy Web å·¥ä½œæµ]         â”‚
â”‚ - éƒ¨ç½² Web åˆ° GitHub Pages  â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ”¯æŒçš„å¹³å°

| å¹³å° | è¾“å‡ºæ–‡ä»¶ | æ„å»ºæ—¶é—´ | ç­¾å |
|------|---------|--------|------|
| ğŸ“± Android | danbooru-viewer-android-release.apk | 10-15 min | âŒ éœ€æ‰‹åŠ¨ |
| ğŸ iOS | danbooru-viewer-ios-release.ipa | 20-25 min | âŒ æœªç­¾å |
| ğŸ§ Linux | danbooru-viewer-linux-release.tar.gz | 12-18 min | âœ… |
| ğŸªŸ Windows | danbooru-viewer-windows-release.zip | 15-20 min | âœ… |
| ğŸŒ Web | danbooru-viewer-web-release.tar.gz | 8-12 min | âœ… |
| | + GitHub Release | 2-3 min | âœ… |
| **æ€»è®¡** | **5 ä¸ªå¹³å°** | **~45 min** | - |

---

## ğŸ”‘ å…³é”®ç‰¹æ€§

### âœ… å·²å®ç°
- [x] å¤šå¹³å°å¹¶è¡Œæ„å»º
- [x] è‡ªåŠ¨ GitHub Release ç”Ÿæˆ
- [x] Web è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages
- [x] ä»£ç è´¨é‡æ£€æŸ¥å’Œæµ‹è¯•
- [x] æ„å»ºç¼“å­˜åŠ é€Ÿ
- [x] è¯¦ç»†æ—¥å¿—å’Œé”™è¯¯æŠ¥å‘Š
- [x] Tag è‡ªåŠ¨è§¦å‘æ„å»º

### ğŸ“‹ å¯é€‰åŠŸèƒ½ï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰
- [ ] Apple Developer ç­¾åï¼ˆiOSï¼‰
- [ ] åº”ç”¨ç­¾åï¼ˆAndroidï¼‰
- [ ] App Store Connect ä¸Šä¼ 
- [ ] Google Play Store ä¸Šä¼ 
- [ ] Slack/Email é€šçŸ¥
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

```
é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ README.md                    â† é¡¹ç›®æ€»è§ˆï¼ˆåŒ…å« CI/CD è¯´æ˜ï¼‰
â”œâ”€â”€ CHANGELOG.md                 â† ç‰ˆæœ¬å˜æ›´å†å²
â”œâ”€â”€ RELEASE_GUIDE.md             â† å¿«é€Ÿå‘å¸ƒæŒ‡å— â­
â””â”€â”€ .github/
    â”œâ”€â”€ WORKFLOWS.md             â† å·¥ä½œæµè¯¦ç»†æ–‡æ¡£ â­
    â”œâ”€â”€ VERSION_HISTORY.md       â† ç‰ˆæœ¬ç®¡ç†å’Œè®°å½•
    â””â”€â”€ workflows/
        â”œâ”€â”€ build.yml            â† Release æ„å»ºå·¥ä½œæµ
        â”œâ”€â”€ ci.yml               â† CI å·¥ä½œæµ
        â””â”€â”€ deploy-web.yml       â† Web éƒ¨ç½²å·¥ä½œæµ
```

### æ¨èé˜…è¯»é¡ºåº

1. **RELEASE_GUIDE.md** - å¿«é€Ÿä¸Šæ‰‹ï¼ˆ5-10 åˆ†é’Ÿï¼‰
2. **.github/WORKFLOWS.md** - æ·±å…¥äº†è§£ï¼ˆ10-15 åˆ†é’Ÿï¼‰
3. **å·¥ä½œæµ YAML æ–‡ä»¶** - è‡ªå®šä¹‰é…ç½®ï¼ˆå¯é€‰ï¼‰

---

## ğŸ› ï¸ å®šåˆ¶è¯´æ˜

### ä¿®æ”¹æ„å»ºå‚æ•°

ç¼–è¾‘ `.github/workflows/build.yml`:

```yaml
- name: Build APK (Android)
  run: flutter build apk --release --split-per-abi
  # æ·»åŠ æ›´å¤šå‚æ•°ï¼š
  # flutter build apk --release --split-per-abi --obfuscate --split-debug-info=build/
```

### é™åˆ¶ç‰¹å®šå¹³å°

åœ¨ `build.yml` çš„ `matrix` ä¸­ç§»é™¤ä¸éœ€è¦çš„å¹³å°é…ç½®ã€‚

### ä¿®æ”¹ Tag æ ¼å¼

ç¼–è¾‘å·¥ä½œæµæ–‡ä»¶çš„ `on.push.tags` éƒ¨åˆ†ï¼š

```yaml
on:
  push:
    tags:
      - 'v*'           # ç°æœ‰ï¼šv1.0.0, v2.0.0-beta ç­‰
      - 'release-*'    # æ–°å¢ï¼šrelease-1.0.0 ç­‰
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### iOS/Android ç­¾å

- **iOS IPA** å½“å‰**æœªç­¾å**ï¼Œéœ€è¦ï¼š
  - Xcode çš„ codesign å·¥å…·
  - Apple Developer è´¦æˆ·
  - é…ç½®æ–‡ä»¶å’Œè¯ä¹¦

- **Android APK** å½“å‰**æœªç­¾å**ï¼Œéœ€è¦ï¼š
  - Keystore æ–‡ä»¶
  - å¯†é’¥åˆ«åå’Œå¯†ç 

è¯¦è§å„å¹³å°çš„å®˜æ–¹æ–‡æ¡£ã€‚

### æ€§èƒ½è€ƒè™‘

- é¦–æ¬¡æ„å»ºä¼šç¼“å­˜ Flutter SDKï¼Œåç»­æ„å»ºåŠ é€Ÿ
- å¹¶è¡Œæ„å»ºéœ€è¦å……è¶³çš„ GitHub Actions å¹¶å‘é…é¢
- å¤§å‹åº”ç”¨å¯èƒ½éœ€è¦å¢åŠ è¶…æ—¶æ—¶é—´

### ç½‘ç»œé—®é¢˜

- pub.dev ä¸å¯ç”¨æ—¶ä¼šå¯¼è‡´æ„å»ºå¤±è´¥
- å›½å†…ç”¨æˆ·å¯é…ç½® pub é•œåƒï¼ˆåœ¨é¡¹ç›®æœ¬åœ°ï¼Œå·¥ä½œæµå·²åœ¨äº‘ç«¯ï¼‰

---

## ğŸ“ æ•…éšœæ’æŸ¥

### å¸¸è§é”™è¯¯

| é”™è¯¯ | åŸå›  | è§£å†³ |
|------|------|------|
| "Could not resolve the package" | ä¾èµ–æœªæ‰¾åˆ° | é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œ |
| iOS ç­¾åé”™è¯¯ | ç¼ºå°‘é…ç½® | ä½¿ç”¨ --no-codesign |
| Windows ç¼–è¯‘å¤±è´¥ | ç¼ºå°‘ C++ å·¥å…· | æœ¬åœ°å®‰è£…æˆ–ä½¿ç”¨å…¶ä»– runner |
| è¶…æ—¶ | æ„å»ºå¤ªæ…¢ | å¢åŠ  timeout æˆ–ä½¿ç”¨æ›´å¼ºå¤§çš„ runner |

### è°ƒè¯•

1. æ£€æŸ¥ Actions æ—¥å¿—ï¼š
   ```
   GitHub â†’ Actions â†’ å¯¹åº”å·¥ä½œæµ â†’ æŸ¥çœ‹æ—¥å¿—
   ```

2. æœ¬åœ°é‡ç°æ„å»ºï¼š
   ```bash
   flutter build apk --release  # Android
   flutter build ios --release  # iOS ç­‰
   ```

3. æŸ¥çœ‹å®Œæ•´æ—¥å¿—ï¼š
   - å±•å¼€å·¥ä½œæµçš„æ¯ä¸ªæ­¥éª¤
   - æŸ¥çœ‹é”™è¯¯å †æ ˆè·Ÿè¸ª

---

## ğŸ“ æœ€ä½³å®è·µ

### ç‰ˆæœ¬ç®¡ç†

```
å¼€å‘åˆ†æ”¯ (develop)
         â†“
    ä»£ç å®¡æŸ¥ (PR)
         â†“
    åˆå¹¶åˆ° main
         â†“
    åˆ›å»º Git Tag
         â†“
    è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒ
```

### åˆ†æ”¯ç­–ç•¥

- `main` - ç¨³å®šç”Ÿäº§åˆ†æ”¯ï¼Œä»…æ¥æ”¶å‘å¸ƒç‰ˆæœ¬
- `develop` - å¼€å‘åˆ†æ”¯ï¼Œæ¥æ”¶åŠŸèƒ½å’Œ Bug ä¿®å¤ PR
- `feature/*` - åŠŸèƒ½åˆ†æ”¯
- `hotfix/*` - ç´§æ€¥ä¿®å¤åˆ†æ”¯

### ç‰ˆæœ¬å·è§„èŒƒ

- éµå¾ª [Semantic Versioning](https://semver.org/)
- Tag æ ¼å¼ï¼š`vä¸».æ¬¡.è¡¥` (ä¾‹ï¼š`v1.0.0`)
- é¢„å‘å¸ƒï¼š`v1.0.0-alpha.1`, `v1.0.0-beta.1`

---

## ğŸ‰ æ€»ç»“

ä½ çš„é¡¹ç›®ç°å·²æ‹¥æœ‰å®Œæ•´çš„ CI/CD æµç¨‹ï¼š

âœ… **ä»£ç æ£€æŸ¥** - è‡ªåŠ¨åŒ–è´¨é‡æ§åˆ¶  
âœ… **å¤šå¹³å°æ„å»º** - ä¸€é”®ç”Ÿæˆæ‰€æœ‰ç‰ˆæœ¬  
âœ… **è‡ªåŠ¨å‘å¸ƒ** - GitHub Release è‡ªåŠ¨åˆ›å»º  
âœ… **Web éƒ¨ç½²** - GitHub Pages è‡ªåŠ¨æ›´æ–°  
âœ… **å®Œæ•´æ–‡æ¡£** - è¯¦ç»†çš„ä½¿ç”¨å’Œå‚è€ƒæŒ‡å—  

### ä¸‹ä¸€æ­¥

1. ğŸ‘‰ é˜…è¯» [RELEASE_GUIDE.md](RELEASE_GUIDE.md)
2. ğŸ‘‰ æ¨é€ä»£ç åˆ° GitHub
3. ğŸ‘‰ åˆ›å»ºç¬¬ä¸€ä¸ª Release Tag
4. ğŸ‘‰ ç›‘æ§ GitHub Actions å®Œæˆæ„å»º
5. ğŸ‘‰ åœ¨ GitHub Releases ä¸‹è½½äº§ç‰©

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸš€
