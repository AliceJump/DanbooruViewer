# GitHub Actions å·¥ä½œæµæŒ‡å—

æœ¬é¡¹ç›®é…ç½®äº†ä¸‰ä¸ª GitHub Actions å·¥ä½œæµï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒã€‚

## å·¥ä½œæµè¯´æ˜

### 1. CI å·¥ä½œæµ (ci.yml)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯
- æäº¤ Pull Request åˆ° `main` æˆ– `develop` åˆ†æ”¯

**æ‰§è¡Œä»»åŠ¡ï¼š**
- âœ… ä»£ç æ ¼å¼æ£€æŸ¥
- âœ… ä»£ç é™æ€åˆ†æ (flutter analyze)
- âœ… å•å…ƒæµ‹è¯• (flutter test)
- âœ… æ„å»º Android Debug APK
- âœ… æ„å»º Web Debug ç‰ˆæœ¬

**è¾“å‡ºï¼š**
- Android Debug APKï¼ˆä¿å­˜ 5 å¤©ï¼‰
- Web Debug ç‰ˆæœ¬ï¼ˆä¿å­˜ 5 å¤©ï¼‰

**ä½•æ—¶ä½¿ç”¨ï¼š**
- å¼€å‘ä¸­çš„æŒç»­é›†æˆ
- ç¡®ä¿ä»£ç è´¨é‡å’ŒåŸºæœ¬çš„æ„å»ºéªŒè¯

---

### 2. Build Release å·¥ä½œæµ (build.yml)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€ Git Tagï¼Œæ ¼å¼ä¸º `v*`ï¼ˆä¾‹ï¼š`v1.0.0`ã€`v1.2.3-beta`ï¼‰

**æ‰§è¡Œä»»åŠ¡ï¼š**
ä¸ºä»¥ä¸‹å¹³å°å¹¶è¡Œæ„å»º Release ç‰ˆæœ¬ï¼š
- ğŸ“± **Android**ï¼šæ„å»º APKï¼ˆåˆ†ç¦»æ¶æ„ç‰ˆæœ¬ï¼‰
- ğŸ **iOS**ï¼šæ„å»º IPAï¼ˆæœªç­¾åï¼‰
- ğŸ§ **Linux**ï¼šæ„å»ºå¯æ‰§è¡Œç¨‹åº + å…±äº«åº“
- ğŸªŸ **Windows**ï¼šæ„å»ºå¯æ‰§è¡Œç¨‹åº
- ğŸŒ **Web**ï¼šæ„å»ºé™æ€ç½‘ç«™

**è¾“å‡ºï¼š**
- æ‰€æœ‰æ„å»ºäº§ç‰©ä½œä¸º Release Artifactsï¼ˆä¿å­˜ 30 å¤©ï¼‰
- è‡ªåŠ¨åˆ›å»º GitHub Releaseï¼Œé™„åŠ æ‰€æœ‰æ„å»ºæ–‡ä»¶

**ä½•æ—¶ä½¿ç”¨ï¼š**
```bash
# åˆ›å»º Release ç‰ˆæœ¬
git tag v1.0.0
git push origin v1.0.0
```

---

### 3. Deploy Web å·¥ä½œæµ (deploy-web.yml)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€ Git Tagï¼Œæ ¼å¼ä¸º `v*`
- æ¨é€åˆ° `main` åˆ†æ”¯

**æ‰§è¡Œä»»åŠ¡ï¼š**
- ğŸŒ æ„å»º Web Release ç‰ˆæœ¬
- ğŸ“¤ è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages

**è¾“å‡ºï¼š**
- è‡ªåŠ¨åœ¨ GitHub Pages ä¸Šéƒ¨ç½² Web ç‰ˆæœ¬
- è®¿é—®åœ°å€ï¼š`https://<username>.github.io/danbooru-viewer/`

**ä½•æ—¶ä½¿ç”¨ï¼š**
- å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼ŒWeb ç‰ˆæœ¬è‡ªåŠ¨éƒ¨ç½²
- æˆ–è€… main åˆ†æ”¯æœ‰æ›´æ–°æ—¶è‡ªåŠ¨éƒ¨ç½²

---

## å¿«é€Ÿå¼€å§‹

### åˆ›å»º Release ç‰ˆæœ¬

1. **æ›´æ–°ç‰ˆæœ¬å·**ï¼ˆå¯é€‰ï¼Œæ›´æ–° pubspec.yamlï¼‰ï¼š
   ```yaml
   version: 1.0.0+1
   ```

2. **åˆ›å»ºå¹¶æ¨é€ Tag**ï¼š
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

3. **GitHub Actions è‡ªåŠ¨æ‰§è¡Œï¼š**
   - æ„å»ºæ‰€æœ‰å¹³å°çš„ Release ç‰ˆæœ¬ï¼ˆçº¦ 30-45 åˆ†é’Ÿï¼‰
   - åœ¨ GitHub Releases é¡µé¢åˆ›å»ºæ–° Release
   - æ‰€æœ‰æ„å»ºäº§ç‰©ä½œä¸ºä¸‹è½½é™„ä»¶

4. **æŸ¥çœ‹æ„å»ºçŠ¶æ€ï¼š**
   - åœ¨ GitHub ä»“åº“çš„ "Actions" é¡µé¢æŸ¥çœ‹
   - ç»¿è‰²å¯¹å‹¾ âœ… = æ„å»ºæˆåŠŸ
   - çº¢è‰²å‰å· âŒ = æ„å»ºå¤±è´¥

---

## ç¯å¢ƒéœ€æ±‚

æ‰€æœ‰å·¥ä½œæµå‡ä½¿ç”¨ GitHub-hosted runnersï¼Œæ— éœ€é¢å¤–é…ç½®ï¼š

- **Ubuntu Latest** (ç”¨äº Androidã€Linuxã€Web æ„å»º)
- **macOS Latest** (ç”¨äº iOS æ„å»º)
- **Windows Latest** (ç”¨äº Windows æ„å»º)

---

## æ–‡ä»¶ç»“æ„

```
.github/
â””â”€â”€ workflows/
    â”œâ”€â”€ build.yml           # Release ç‰ˆæœ¬æ„å»ºå·¥ä½œæµ
    â”œâ”€â”€ ci.yml              # æŒç»­é›†æˆå·¥ä½œæµ
    â””â”€â”€ deploy-web.yml      # Web éƒ¨ç½²å·¥ä½œæµ
```

---

## å¸¸è§é—®é¢˜

### Q: iOS æ„å»ºå¤±è´¥ï¼Œæç¤ºä»£ç ç­¾åé—®é¢˜
A: iOS Release æ„å»ºä½¿ç”¨ `--no-codesign` å‚æ•°ï¼Œç”Ÿæˆçš„ IPA ä»…ç”¨äºæµ‹è¯•ã€‚å¦‚éœ€ç”Ÿäº§ç­¾åï¼Œéœ€è¦ï¼š
1. åœ¨å·¥ä½œæµä¸­é…ç½® Apple Developer è´¦æˆ·
2. æ·»åŠ è¯ä¹¦å’Œé¢„é…æ–‡ä»¶
3. ä½¿ç”¨ `--code-sign-identity` å‚æ•°

### Q: Windows æ„å»ºå¾ˆæ…¢
A: Windows æ„å»ºæ—¶é—´è¾ƒé•¿ï¼ˆé€šå¸¸ 15-20 åˆ†é’Ÿï¼‰ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

### Q: å¦‚ä½•è·³è¿‡æŸä¸ªå¹³å°çš„æ„å»ºï¼Ÿ
A: ç¼–è¾‘ `build.yml` çš„ `matrix` éƒ¨åˆ†ï¼Œç§»é™¤ä¸éœ€è¦çš„å¹³å°é…ç½®ã€‚

### Q: æ„å»ºå¤±è´¥äº†ï¼Œå¦‚ä½•æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Ÿ
A: åœ¨ GitHub Actions é¡µé¢æŸ¥çœ‹å¯¹åº”å·¥ä½œæµè¿è¡Œçš„è¯¦ç»†æ—¥å¿—ã€‚

### Q: Release ç‰ˆæœ¬ä¸‹è½½ä¸åˆ°æ–‡ä»¶ï¼Ÿ
A: æ£€æŸ¥å·¥ä½œæµæ˜¯å¦å…¨éƒ¨æˆåŠŸï¼ˆç»¿è‰²å¯¹å‹¾ï¼‰ã€‚å¦‚æœæœ‰å¤±è´¥ï¼Œéœ€è¦ä¿®å¤åé‡æ–°åˆ›å»º Tagã€‚

---

## ä¼˜åŒ–å»ºè®®

### 1. åŠ é€Ÿæ„å»º
```yaml
# å·²å¯ç”¨ç¼“å­˜ï¼Œå¯è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š
- å¢åŠ  Flutter ä¾èµ–ç¼“å­˜
- ä½¿ç”¨æ›´å¼ºå¤§çš„ runnerï¼ˆself-hostedï¼‰
```

### 2. è‡ªå®šä¹‰æ„å»ºå‚æ•°
ç¼–è¾‘å„å·¥ä½œæµæ–‡ä»¶ï¼Œåœ¨ `flutter build` å‘½ä»¤ä¸­æ·»åŠ é¢å¤–å‚æ•°ï¼š
```bash
flutter build apk --release --split-per-abi --obfuscate --split-debug-info=build/
```

### 3. æ·»åŠ é€šçŸ¥
åœ¨å·¥ä½œæµä¸­æ·»åŠ é€šçŸ¥æ­¥éª¤ï¼ˆé‚®ä»¶ã€Slack ç­‰ï¼‰ï¼š
```yaml
- name: Send Notification
  if: failure()
  run: # å‘é€å¤±è´¥é€šçŸ¥
```

### 4. è‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†
ä½¿ç”¨ `actions/github-script` è‡ªåŠ¨æå–ç‰ˆæœ¬å·ï¼š
```yaml
- name: Get version
  id: version
  run: echo "VERSION=$(grep version pubspec.yaml | head -1 | awk '{print $2}')" >> $GITHUB_OUTPUT
```

---

## å®‰å…¨æ€§å»ºè®®

- âœ… GitHub Actions ä½¿ç”¨ `GITHUB_TOKEN` è‡ªåŠ¨è·å–æƒé™
- âœ… æ‰€æœ‰æ„å»ºåœ¨éš”ç¦»çš„ GitHub-hosted runners ä¸Šæ‰§è¡Œ
- âš ï¸ å¦‚éœ€ç­¾åæˆ–éƒ¨ç½²ï¼Œä½¿ç”¨ GitHub Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯

---

## å‚è€ƒèµ„æº

- [Flutter å®˜æ–¹ CI/CD æŒ‡å—](https://docs.flutter.dev/deployment/cd)
- [GitHub Actions æ–‡æ¡£](https://docs.github.com/en/actions)
- [ä½¿ç”¨ GitHub Actions æ„å»º Flutter åº”ç”¨](https://github.com/marketplace/actions/flutter-action)
